{% extends 'base.html' %}
{% load staticfiles %}
{% load humanize %}
{% block title %}Monthly Balances{% endblock %}


{% block content %}
  <form method="POST" action="{% url 'new_monthly_balance' %}">
    {{ form }}
    <input type="submit" id="id_submit" value="Submit">
    {% csrf_token %}
  </form>

  {% if errors %}
      <div>{{ errors }}</div>
  {% endif %}
  {% csrf_token %}

  {% if bar_graph %}
    <div >
      <img src="data:image/png;base64,{{ bar_graph }}" class="img-fluid" alt="Bar graph">
    </div>
  {% endif %}

{% if not bar_graph %}
  {% if show_delete %}
    <a href="?delete=0">Hide delete buttons</a>
  {% else %}
    <a href="?delete=1">Show delete buttons</a>
  {% endif %}
  <hr>
{% endif %}

<table class="table table-responsive-md table-sm" id="id_monthly_balances">
  <tr>
    <th>Date</th>
    <th>Amount</th>
    {% if not bar_graph %}
      <th>Category</th>
      <th>Is foreign currency?</th>
      <th>ID</th>
      {% if show_delete %}
        <th><b>Delete</b></th>
      {% endif %}
    {% else %}
      <th>Month details</th>
    {% endif %}
  </tr>
  {% for monthly_balance in monthly_balance reversed %}
    <tr>
      <td>{{ monthly_balance.date | date:'Y-m' }}</td>
      <td>{{ monthly_balance.amount | intcomma }}</td>
      {% if not bar_graph %}
        <td>{{ monthly_balance.category.text }}</td>
        <td>{{ monthly_balance.category.is_foreign_currency }}</td>
        <td>
          <a href={% url 'edit_monthly_balance' monthly_balance.id %}>Edit</a>
        </td>
        {% if show_delete %}
           <td>
            <form method="POST" action="{% url 'delete_monthly_balance' id=monthly_balance.id %}">
              {% csrf_token %}
              <input type="submit" id="id_submit" value="Yes, DELETE">
            </form>
          </td>
        {% endif %}
      {% else %}
        {% with ym_date=monthly_balance.date|date:'Y-m' %}
        <td><a href={% url 'monthly_balances' ym_date %}>See details</a></td>
        {% endwith %}
     {% endif %}
    </tr>
  {% endfor %}
  {% if total > 0 and not bar_graph%}
    <tr>
      <td>Total</td>
      <td>{{ total | intcomma }}</td>
      <td> - </td>
      <td> - </td>
    </tr>
  {% endif %}
</table>

{% endblock %}